<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Cháº©n Ä‘oÃ¡n sá»©c khá»e</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 h-screen flex font-sans">
    <!-- Sidebar -->
    <aside class="w-64 bg-[#4F6EF7] text-white flex flex-col p-5">
      <h2 class="text-xl font-bold mb-8 mt-4">ğŸ§‘â€âš•ï¸ Trang Chá»§</h2>
      <nav class="space-y-3 text-md font-medium">
        <a
          href="http://127.0.0.1:7003/api/patients/appointment_view/"
          class="flex items-center gap-2 hover:bg-white/10 rounded px-3 py-2"
          >ğŸ“… Lá»‹ch sá»­ Ä‘áº·t lá»‹ch</a
        >
        <a
          href="http://127.0.0.1:7003/api/patients/diagnosis_form_view/"
          class="flex items-center gap-2 hover:bg-white/10 rounded px-3 py-2"
          >ğŸ“ Cháº©n Ä‘oÃ¡n sá»©c khá»e</a
        >
      </nav>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col">
      <!-- Header -->
      <header
        class="flex items-center justify-between px-6 py-4 bg-white border-b shadow-sm"
      >
        <input
          type="text"
          placeholder="ğŸ” Search..."
          class="border border-gray-300 rounded px-4 py-1 w-1/3 focus:outline-none focus:ring focus:border-blue-400"
        />
        <div class="flex items-center gap-4">
          <span id="user-info" class="text-sm text-gray-700 font-medium"
            >ğŸ‘¤ TÃ i khoáº£n</span
          >
          <button
            onclick="handleLogout()"
            class="bg-[#4F6EF7] text-white px-3 py-1 rounded hover:bg-blue-700 text-sm"
          >
            ğŸ“• ÄÄƒng xuáº¥t
          </button>
        </div>
      </header>

      <!-- Content -->
      <main class="flex-1 flex justify-center items-center py-8">
        <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
          <h1 class="text-2xl font-bold mb-6 text-center text-blue-600">
            ğŸ§  Cháº©n Ä‘oÃ¡n sá»©c khá»e
          </h1>
          <form id="symptomForm">
            <p class="font-semibold mb-4">Chá»n cÃ¡c triá»‡u chá»©ng báº¡n Ä‘ang gáº·p:</p>
            <label class="block mb-2"
              ><input
                type="checkbox"
                name="symptom1"
                value="1"
                class="mr-2"
              />Sá»‘t (sá»‘t cao, á»›n láº¡nh)</label
            >
            <label class="block mb-2"
              ><input
                type="checkbox"
                name="symptom2"
                value="1"
                class="mr-2"
              />Ho (ho khan hoáº·c cÃ³ Ä‘á»m)</label
            >
            <label class="block mb-2"
              ><input
                type="checkbox"
                name="symptom3"
                value="1"
                class="mr-2"
              />Háº¯t hÆ¡i (ngháº¹t mÅ©i, háº¯t hÆ¡i liÃªn tá»¥c)</label
            >
            <label class="block mb-2"
              ><input
                type="checkbox"
                name="symptom4"
                value="1"
                class="mr-2"
              />Má»‡t má»i (yáº¿u cÆ¡, uá»ƒ oáº£i)</label
            >
            <label class="block mb-2"
              ><input
                type="checkbox"
                name="symptom5"
                value="1"
                class="mr-2"
              />Máº¥t vá»‹ giÃ¡c (khÃ´ng cáº£m nháº­n Ä‘Æ°á»£c mÃ¹i vá»‹)</label
            >
            <label class="block mb-2"
              ><input
                type="checkbox"
                name="symptom6"
                value="1"
                class="mr-2"
              />Ngá»©a máº¯t (máº¯t Ä‘á», ngá»©a hoáº·c cháº£y nÆ°á»›c máº¯t)</label
            >
            <button
              type="submit"
              class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 mt-4"
            >
              ğŸ§ª Cháº©n Ä‘oÃ¡n
            </button>
          </form>
          <div id="result" class="mt-6 p-4 rounded-lg hidden"></div>
        </div>
      </main>
    </div>

    <script>
      async function loadPatientInfo() {
        const userId = localStorage.getItem("userId");
        const username = localStorage.getItem("username");
        console.log("Username", username);

        document.getElementById("user-info").innerText =
          "ğŸ‘¨â€âš•ï¸ " + (username || "TÃ i khoáº£n");
      }

      function handleLogout() {
        localStorage.clear();
        window.location.href = "http://127.0.0.1:7000/api/auth/login_view/";
      }

      loadPatientInfo();

      const form = document.getElementById("symptomForm");
      const resultBox = document.getElementById("result");

      const diseaseInfo = {
        Flu: {
          name: "CÃºm mÃ¹a",
          desc: "Bá»‡nh nhiá»…m siÃªu vi thÃ´ng thÆ°á»ng, gÃ¢y sá»‘t, má»‡t má»i, Ä‘au Ä‘áº§u, ho.",
          care: "Nghá»‰ ngÆ¡i nhiá»u, uá»‘ng nhiá»u nÆ°á»›c, cÃ³ thá»ƒ dÃ¹ng Tamiflu.",
        },
        Cold: {
          name: "Cáº£m láº¡nh",
          desc: "Bá»‡nh nhiá»…m virus nháº¹ gÃ¢y háº¯t hÆ¡i, ngháº¹t mÅ©i, ho nháº¹ vÃ  Ä‘au há»ng.",
          care: "Uá»‘ng nhiá»u nÆ°á»›c, ngá»§ Ä‘á»§, dÃ¹ng thuá»‘c giáº£m triá»‡u chá»©ng nhÆ° Paracetamol.",
        },
        "COVID-19": {
          name: "COVID-19",
          desc: "Bá»‡nh do virus SARS-CoV-2 gÃ¢y ra, cÃ³ thá»ƒ gÃ¢y sá»‘t, máº¥t vá»‹ giÃ¡c, khÃ³ thá»Ÿ.",
          care: "CÃ¡ch ly, theo dÃµi nhiá»‡t Ä‘á»™, dÃ¹ng thuá»‘c háº¡ sá»‘t vÃ  theo dÃµi oxy mÃ¡u.",
        },
        Allergy: {
          name: "Dá»‹ á»©ng",
          desc: "Pháº£n á»©ng cá»§a há»‡ miá»…n dá»‹ch vá»›i cÃ¡c yáº¿u tá»‘ nhÆ° pháº¥n hoa, lÃ´ng Ä‘á»™ng váº­t.",
          care: "TrÃ¡nh dá»‹ nguyÃªn, dÃ¹ng thuá»‘c khÃ¡ng histamin nhÆ° Loratadine, Cetirizine.",
        },
      };

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const checkboxes = form.querySelectorAll('input[type="checkbox"]');
        const symptoms = Array.from(checkboxes).map((box) =>
          box.checked ? 1 : 0
        );
        const data = { symptoms };

        const res = await fetch("/api/diagnosis/predict/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });

        const json = await res.json();
        resultBox.classList.remove("hidden");

        if (json.error) {
          resultBox.className = "mt-6 p-4 rounded-lg bg-red-100 text-red-700";
          resultBox.innerHTML = "âŒ " + json.error;
          return;
        }

        const disease = diseaseInfo[json.diagnosis];
        resultBox.className = "mt-6 p-4 rounded-lg bg-green-100 text-green-700";
        resultBox.innerHTML = `
        ğŸ§¬ <strong>Bá»‡nh cháº©n Ä‘oÃ¡n:</strong> <em>${disease.name}</em><br><br>
        ğŸ” <strong>ThÃ´ng tin:</strong> ${disease.desc}<br>
        ğŸ’¡ <strong>ChÄƒm sÃ³c:</strong> ${disease.care}<br>
        ğŸ§« <strong>XÃ©t nghiá»‡m Ä‘á» xuáº¥t:</strong> ${json.test_suggested}<br>
        ğŸ’Š <strong>Thuá»‘c Ä‘á» xuáº¥t:</strong> ${json.medicine_suggested}<br>
        ğŸ“Š <strong>Äá»™ tin cáº­y AI:</strong> ${(json.confidence * 100).toFixed(
          2
        )}% Â± ${(json.uncertainty * 100).toFixed(2)}%
      `;
      });
    </script>
  </body>
</html>
