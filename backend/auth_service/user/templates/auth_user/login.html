<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Đăng nhập</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 flex justify-center items-center h-screen">
    <form
      class="bg-white p-8 rounded-lg shadow-md w-full max-w-md"
      id="loginForm"
    >
      <h2 class="text-2xl font-bold mb-6 text-center text-blue-600">
        🔐 Đăng nhập
      </h2>
      <div class="mb-4">
        <label class="block mb-1">Tên đăng nhập</label>
        <input
          type="text"
          name="username"
          class="w-full border px-3 py-2 rounded"
          required
        />
      </div>
      <div class="mb-4">
        <label class="block mb-1">Mật khẩu</label>
        <input
          type="password"
          name="password"
          class="w-full border px-3 py-2 rounded"
          required
        />
      </div>
      <button
        type="submit"
        class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700"
      >
        Đăng nhập
      </button>
      <p id="message" class="text-center mt-4 text-red-600"></p>
    </form>

    <script>
      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const form = e.target;
          const data = {
            username: form.username.value,
            password: form.password.value,
          };
          const res = await fetch("/api/auth/login/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });
          const json = await res.json();
          const msg = document.getElementById("message");
          if (res.ok) {
            msg.textContent = "✅ Đăng nhập thành công!";
            msg.className = "text-green-600 text-center mt-4";
            // Lưu token nếu cần
            console.log("Access:", json.access);
            window.location.href = "http://localhost:8001/api/patients/update/";
          } else {
            msg.textContent =
              "❌ Đăng nhập thất bại: " + (json.detail || "Lỗi không xác định");
          }
        });
    </script>
  </body>
</html>
